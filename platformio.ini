; PlatformIO Project Configuration File
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

[platformio]
default_envs = az-delivery-devkit-v4

; Common section (used for interpolation as ${common.*})
[common]
monitor_speed = 115200

lib_deps =
    SignalK/SensESP@^3.1.1
    SensESP/OneWire@^3.0.1

build_flags =
    -D CORE_DEBUG_LEVEL=ARDUHAL_LOG_LEVEL_VERBOSE
    -D USE_ESP_IDF_LOG
    -D TAG=\"Arduino\"

board_build.partitions = min_spiffs.csv

build_unflags =
    -Werror=reorder
monitor_filters = esp32_exception_decoder

; Environment that other envs can extend. Keep as [env:common] so it's usable
; as a PlatformIO environment as well.
[env:common]
monitor_speed = ${common.monitor_speed}
lib_deps = ${common.lib_deps}
build_flags = ${common.build_flags}
board_build.partitions = ${common.board_build.partitions}
build_unflags = ${common.build_unflags}
monitor_filters = ${common.monitor_filters}

[arduino]
platform = espressif32 @ ^6.9.0
framework = arduino

lib_ignore =
    esp_websocket_client

build_flags =
    ${common.build_flags}

[pioarduino]
; Use the standard espressif32 platform for readability unless you depend on
; a specific custom build. Replace with a direct URL only if needed.
platform = espressif32 @ ^6.9.0
framework = arduino

lib_deps =
    ${common.lib_deps}
    ; The `esp_websocket_client` component is required for the ESP-IDF
    ; websocket implementation. We include the component only for the
    ; platform build that needs it.
    esp_websocket_client=https://components.espressif.com/api/downloads/?object_type=component&object_id=dbc87006-9a4b-45e6-a6ab-b286174cb413

[espidf]
platform = espressif32 @ ^6.9.0
framework = espidf, arduino

board_build.embed_txtfiles =
    managed_components/espressif__esp_insights/server_certs/https_server.crt
    managed_components/espressif__esp_rainmaker/server_certs/rmaker_mqtt_server.crt
    managed_components/espressif__esp_rainmaker/server_certs/rmaker_claim_service_server.crt
    managed_components/espressif__esp_rainmaker/server_certs/rmaker_ota_server.crt

lib_deps =
    ${common.lib_deps}
    esp_websocket_client=https://components.espressif.com/api/downloads/?object_type=component&object_id=dbc87006-9a4b-45e6-a6ab-b286174cb413

build_flags =
    ${common.build_flags}

[env:az-delivery-devkit-v4]
extends = pioarduino, common
board = az-delivery-devkit-v4
upload_protocol = esptool

; Test environment for unit testing
[env:test]
extends = pioarduino, common
board = az-delivery-devkit-v4
test_framework = unity
; Build only necessary source files for tests - exclude Main.cpp
test_build_src = yes
build_src_filter = -<*> +<sensor_config.cpp> +<onewire_helper.cpp>
; Run all tests by default
; Use -e test -f test_onewire_helper to run specific test
test_filter = *

; Native test environment for development without hardware
[env:native]
platform = native
test_framework = unity
test_build_src = no
build_flags = -std=c++11
